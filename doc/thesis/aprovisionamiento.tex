\chapter{Aprovisionamiento}
\label{capaprovisionamiento}

VirtShell cuenta con una colección de recursos, que permite el aprovisionamiento de instancias,independientemente de la infraestructura de visualización que se use para estas. El conjunto de recursos de esta capa, esta diseñado para que sea una solución sencilla de usar, fiable y repetible, con una curva de aprendizaje muy baja para los administradores, desarrolladores y administradores de TI. Este capítulo busca describir todo lo que se requiere para llevar a cabo un correcto aprovisionamiento en las instancias creadas a traves el sistema.

\section{Imagenes}
Como se describio en la arquitectura, las imágenes que se manejan en VirtShell son de dos tipos: ISO y \emph{templates} para contenedores. Las imágenes ISO son usadas para la creación de maquinas virtuales que interactuan con un hipervisor. Estas son versiones modificadas de las que se encuentran en los repositorios oficiales de las distintas distribuciones de Linux o de cualquier otro sistema operativo. Para que una imagen pueda ser usada en VirtShell, esta debe cumplir con los siguientes requisitos: 
\begin{itemize}
\item Que su instalación sea completamente desatendida (o automática), esto quiere decir que no requiera intervención humana.
\item Debe tener instalado un servidor SSH con un usuario valido para VirtShell.
\end{itemize}

VirtShell cuenta con un servicio que permite crear versiones desatendidas de la distribución de Linux Ubuntu. Para crear una versión desatendida es necesario proveer un mecanismo para responder a las preguntas formuladas durante el proceso de instalación, sin tener que introducir manualmente las respuestas mientras la instalación está en funcionamiento. Esto se hace posible creando un archivo de pre-configuración con las respuestas y solicitud de instalación de paquetes como el del servidor SSH. Ese archivo debe ser enviando a través del API REST de VirtShell como se muestra a continuación:

\begin{lstlisting}[style=json, caption=Petición HTTP para crear una imagen]
curl -sv -X PUT \
  -H 'accept: application/json' \
  -H "Content-Type: text/plain" \
  -H 'X-VirtShell-Authorization: UserId:Signature' \
  -d '{"name": "ubuntu_server_14.04.2_amd64",
     "type": "iso",
     "os": "ubuntu", 
     "release": "trusty",
     "version": "14.04.2", 
     "variant": "server", 
     "arch": "amd64", 
     "timezone": "America/Bogota", 
     "permissions" : "rwxrwxr--",
     "preseed_url": "https://<host>:<port>/api/virtshell/v1/files/seeds/seed_ubuntu14-04.txt",
     "download_url": "http://releases.ubuntu.com/raring/ubuntu-14.04-server-amd64.iso"}' \
   'http://localhost:8080/api/virtshell/v1/image'
\end{lstlisting}

Como se observa en la petición, para crear una imagen desatendida, el servicio de VirtShell bajara la ISO de la url indicada en el cambo download\_url y aplicara el archivo de respuestas indicado en el campo pressed\_url, un ejemplo del archivo de respuestas se encuentra en el apéndice C.


\section{Aprovisionadores}

\section{Instalación de paquetes y archivos}



