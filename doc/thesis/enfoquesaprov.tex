
\chapter{Aprovisionamiento de recursos virtuales}

\label{aprmaqvir}
La computación en la nube ha sido un punto importante de investigación en la industria recientemente. Esta puede ser descrita como una nueva clase de computación en la cual recursos dinámicos y escalables pueden ser provistos sobre internet. Para los usuarios esto es transparente y ellos solo pagan lo que usan de acuerdo a niveles de servicio establecidos con los proveedores de nubes.\\
\\
En ese contexto, una de las principales características de la computación en la nube es la virtualización, la cual consiste en crear una versión virtual de un recurso tecnológico en lugar de usar una versión física. La virtualización se puede aplicar a computadoras, sistemas operativos, dispositivos de almacenamiento de información, aplicaciones o redes permitiendo que las empresas ejecuten mas de un sistema virtual, ademas de múltiples sistemas operativos y aplicaciones, en un único servidor, de esta manera se logra economía de escala y una mayor eficiencia.\\
\\
Actualmente predominan dos técnicas de visualización, la primera técnica se denomina virtualización de hardware y consiste en crear un hardware sintético el cual usan las maquinas virtuales como propio, la idea es virtualizar el sistema operativo completo el cual se ejecuta sobre un software llamado el hypervisor, su función es interactuar directamente con la CPU en el servidor físico, ofreciendo a cada uno de los servidores virtuales una total autonomía e independencia. Incluso pueden coexistir en una misma maquina distintos servidores virtuales funcionando con distintos sistemas operativos. Esta técnica es la mas desarrollada y hay diferentes clases que cada fabricante ha ido desarrollando y adaptando, como por ejemplo Xen, KVM, VMWare y VirtualBox.\\
\\
La segunda técnica es conocida como virtualización del sistema operativo. En esta técnica lo que se virtualiza es el sistema operativo completo el cual corre directamente virtual sobre la maquina física. En esta técnica las maquinas virtuales son llamadas contenedores, los cuales acceden por igual a todos los recursos del sistema. La ventaja es a su vez una desventaja: Todas las maquinas virtuales usan el mismo Kernel que el sistema operativo lo que reduce mucho los errores y multiplica el rendimiento, pero a su vez solo puede haber un mismo tipo de sistema operativo en los contenedores, no se puede mezclar Windows-Linux-Etc. Este sistema, también se acerca mucho a lo que seria una virtualización nativa.\\
\\
De hecho, sin importar la técnica de virtualización que se use, la instalación de una maquina virtual (o de un contenedor) requiere normalmente de la generación e instalación de una imagen y a su vez de la instalación y configuración de paquetes de software. Estas tareas generalmente son realizadas por técnicos de los proveedores de la nube. Cuando un usuario de la nube solicita un nuevo servicio o mas capacidad de computo, el administrador selecciona la apropiada imagen para clonar e instalar en los nodos de la nube. Si no hay una imagen apropiada para los requerimientos del cliente se crea y configura una nueva que cumpla con la solicitud. Esta creación de una nueva imagen puede ser realizada modificando la imagen mas cercada de las ya existentes. En el momento de la creación optima de la imagen un administrador puede tener dificultades y preguntas como, cual es la mejor configuración?, cuales paquetes y sus dependencias deberían ser instaladas? y como encontrar una imagen que mejor llene las expectativas?.\\
\\
Por lo tanto, los proveedores de la nube desean cada vez mas automatizar y simplificar este proceso porque la dependencia entre paquetes de software y la dificultad de mantenimiento agrega tiempo a la creación de las maquinas virtuales. En otras palabras los proveedores de nube quieren dar mas flexibilidad y agilidad a la hora de satisfacer los requerimientos de los usuarios finales.\\
\\
Ciertamente existen muchas soluciones que permiten la interacción con diferentes ambientes de visualización. Estas soluciones usan diferentes enfoques para realizar despliegues de software en las maquinas virtuales de manera rápida, controlada y automática, en maquinas físicas o virtuales. Sin embargo la mayoría las soluciones no tienen la capacidad de manejar de manera simultanea las dos técnicas de virtualización antes mencionadas, algunas se centran solo en manejar maquinas virtuales y otras pocas solo hacen aprovisionamiento sobre contenedores.\\
\\
Así mismo, hay soluciones de aprovisionamiento que han incorporado su propio lenguaje de aprovisionamiento buscando mayor flexibilidad y fácil configuración de las tareas pero que incorporan una curva de aprendizaje bastante alta lo que se traduce en un gran esfuerzo inicial para contar con toda la infraestructura automatizada. En ese mismo orden de ideas, existen a su vez, soluciones cuya curva de aprendizaje es mucho menor lo que las hace mas atractivas para muchos ingenieros de TI.\\
\\
Adicionalmente, así como se encuentran soluciones o herramientas de aprovisionamiento de desarrollo propietario que cobran por sus funcionalidades mas importantes o por el numero de maquinas que pueden aprovisionar, también se encuentran herramientas de código abierto, o por lo menos de uso libre que permiten trabajar con un gran numero de maquinas virtuales.\\
\\
Al revisar al rededor de 40 diferentes herramientas de aprovisionamiento se logro identificar dos características que no se encuentran en las soluciones actuales, la primera trata de la ausencia de una interfaz o API web para realizar aprovisionamiento remoto, y la segunda se refiere a que las herramientas se limitan a aprovisionar las maquinas virtuales pero no ofrecen mecanismos de administración y monitoreo de la red aprovisionada ni de los hosts que albergan los recursos virtuales.\\
\\
A continuación se describirán algunas de las herramientas mas significativas que existen indicando sus características principales.

\section{Fabric}
Fabric \cite{fabfile16} es una herramienta de automatización que usa SSH para hacer despliegues de aplicaciones y administración de tareas. Fabric es una librería gratuita hecha en python y su forma de interactuar es por medio de linea de comandos por otra parte permite cargar y descargar archivos que pueden ser ejecutados por su conjunto de funciones.

\section{Chef}
Chef es una de las herramientas más conocidas de automatización de infraestructura de nube, esta escrita en Ruby y Erlang. Utiliza un lenguaje de dominio especifico escrito también en Ruby para la escritura y configuración de "recetas". Estas recetas contienen los recursos que deben ser creados. Chef se puede integrar con plataformas basadas en la nube, como Rackspace, Internap, Amazon EC2, Cloud Platform Google, OpenStack, SoftLayer y Microsoft Azure. Adicionalmente puede aprovisionar sobre contenedores si se instala la librería indicada. Chef contiene soluciones para sistemas de peque~na y gran escala. \cite{Chef15}\\
\\
Es uno de los cuatro principales sistemas de gestión de la configuración en Linux, junto con Cfengine, Bcfg2 y Puppet. Para un cierto numero de nodos se puede usar su versión gratuita, pero para contar con todo conjunto de características, administración y soporte no es gratuita.

\section{Puppet}
Puppet es una herramienta diseñada para administrar la configuración de sistemas similares a Unix y a Microsoft Windows de forma declarativa. El usuario describe los recursos del sistema y sus estados utilizando el lenguaje declarativo que proporciona Puppet. Esta información es almacenada en archivos denominados manifiestos Puppet. Puppet descubre la información del sistema a través de una utilidad llamada Facter, y compila los manifiestos en un catalogo especifico del sistema que contiene los recursos y la dependencia de dichos recursos, estos catálogos son ejecutados en los sistemas de destino. \cite{Pupet15}\\
\\
Puppet es de uso gratuito para redes muy pequeñas de hasta solo 10 nodos.

\section{Juju}
Juju \cite{juju16} es una herramienta de configuración y administración de servicios en nubes publicas. Permite crear ambientes completos con unos pocos comandos, cuenta con cientos de servicios pre-configurados y disponibles en la tienda de juju. Se puede usar a través de una interfaz gráfica o de linea de comandos. Juju permite re-crear un ambiente de producción en portátiles usando contenedores enfocado a pruebas. El uso de juju es gratuito pero se debe pagar por el uso de la nube publica.

\section{CFEngine}
CFEngine es un sistema basado en el lenguaje escrito por Mark Burgess, dise~nado específicamente para probar y configurar software. CFEngine es como un lenguaje de muy alto nivel. La idea de CFEngine es crear un único archivo o conjunto de archivos de configuración que describen la configuración de cada host de la red. CFEngine se ejecuta en cada host, y analiza cada archivo (o archivos), que especifica una política para la configuración del sistema; la configuración del host es verificada contra el modelo y, si es necesario, cualquier desviación de la configuración es corregida. \cite{cfengine15}\\
\\
CFEngine cuenta con una versión gratuita y la versión empresarial que cuenta con interfaz gráfica, soporte y reportes.

\section{Ansible}
Ansible \cite{ans16} es una herramienta de código libre desarrollada en python y comercialmente ofrecida por AnsibleWorks los cuales la definen como un motor de orquestación muy simple que automatiza las tareas de despliegue. Ansible no usa agentes, solo necesita tener instalado Python en las maquinas hosts y las tareas las realiza por medio de ssh. Ansible podría trabajar mediante un solo archivo de configuración que contendría todo o por medio de varios archivos organizados en una estructura de directorios. 

\section{Bcfg2}
Bcfg2 esta escrito en Python y permite gestionar la configuración de un gran numero de ordenadores mediante un modelo de configuración central. Bcfg2 funciona con un modelo simple de configuración del sistema, modelando elementos intuitivos como paquetes, servicios y archivos de configuración (así como las dependencias entre ellos). Este modelo de configuración del sistema se utiliza para la verificación  y validación, permitiendo una auditoria robusta de los sistemas desplegados. La especificación de la configuración de Bcfg2 está escrita utilizando un modelo XML declarativo. Toda la especificacion puede ser validada utilizando los validadores de esquema XML ampliamente disponibles. Bcfg2 no tiene soporte para contenedores. Es gratuito y cuenta con una lista limitada de plataformas en las cuales trabaja bien.\cite{bdfg215}

\section{Cobbler}
Cobbler es una plataforma que busca el rápido despliegue de servidores y en general computadores en una infra-estructura de red por medio de linea de comandos, se basa en el modelo de scripts y cuenta con una completa base de simples comandos, que permite hacer despliegues de manera rápida y con poca intervención humana. Cobbler es capaz de instalar maquinas físicas y maquinas virtuales. Cobbler, es una pequena y ligera aplicacion, que es extremadamente facil de usar para pequeños o muy grandes despliegues. Es de uso gratuito y no cuenta con soporte para contenedores. \cite{Cobbler15}

\section{SmartFrog}
SmartFrog (SF) es un framework para servicios de configuración, descripción, despliegue y administración del ciclo de vida. Consiste de un lenguaje declarativo, un motor que corre en los nodos remotos y ejecuta plantillas escritas en el lenguaje de SmartFrog y un modelo de componentes. El lenguaje soporta encapsulación (que es similar a las clases de python), herencia y composición que permite personalizar y combinar configuraciones. SmartFrog, permite enlaces estáticos y dinámicos entre componentes, que ayudan a soportar diferentes formas de conexión en tiempo de despliegue.\\
\\
El modelo de componentes, administra el ciclo de vida a través de cinco estados: instalado, iniciado, terminado y fallido. Esto permite al motor del SmartFrog detectar fallas y reiniciar automáticamente re-despliegues de los componentes \cite{Smart09}.
\\
SmartFrog es desarrollado y mantenido por un equipo de investigación en los laboratorios de Hewlett-Packard en Bristol, Inglaterra, así como por el laboratorio Europeo de Hewlett-Packard y adicional con contribuciones de otros usuarios de SmartFrog y desarrolladores externos a HP. Se utiliza en la investigación de HP específicamente en la automatización de la infraestructura y automatización de servicios, ademas de ser solo utilizado en determinados productos de HP.

\section{Amazon EC2}
Amazon EC2 es un API propietario de Amazon y maneja un enfoque manual, que permite desplegar imágenes de maquinas virtuales conocidas como AMI (Amazon Machine Images) \cite{Amazon16}, que son las imágenes que se utilizan en Amazon para arrancar instancias. El concepto de las amis es similar a las maquinas virtuales de otros sistemas. Básicamente estan compuestas de una serie ficheros de datos que conforman la imagen y luego un xml que especifica ciertos valores necesarios para que sea una imagen valida para Amazon que es el image.manifest.xml. 

\section{Docker composer}
Docker composer permite describir un conjunto de contenedores que se relacionan entre ellos. Docker composer permite definir una aplicación multicontenedor en un archivo con las mismas propiedades que se indicarían en un archivo individual de docker. Docker composer usa archivos en formato yaml para describir las características de los servicios en cada contenedor \cite{doccom16}. Es completamente gratuito. 

\section{Vagrant}
Vagrant es una herramienta de linea de comando que permite la creación y configuración de entornos de desarrollo virtualizados. Originalmente se desarrolló para VirtualBox y sistemas de configuración tales como Chef, Salt y Puppet. Sin embargo desde la versión 1.1 Vagrant es capaz de trabajar con múltiples proveedores, como VMware, Amazon EC2, LXC, DigitalOcean \cite{Vag15}.
\\
Vagrant ofrece múltiples opciones para realizar aprovisionamientos, desde scritps en shell hasta complejos sistemas de configuración.

\section{SaltStack}
SaltStack, es un sistema de manejo de configuración cuyo objetivo es garantizar que un servicio este corriendo o que una aplicación haya sido instalada o desplegada. Salt está construido en Python y al igual que Chef, CFEngine y Puppet utiliza un esquema de cliente (salt minions) - servidor (salt master), cuyo método de conexión con los minions se realiza a través de un broker messages llamado ZeroMQ (0MQ), que no solo garantiza una conexión segura sino que la hace confiable y rápida. Salt tiene una versión gratuita llamada Salt Open sin embargo para obtener todos los beneficios se debe pagar la versión empresarial. Salt cuenta con soporte para contenedores. \cite{Salt15}
